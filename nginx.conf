# ===========================================
# SECURITY HEADERS - NGINX CONFIGURATION
# ===========================================
# Add these headers to your server block in nginx.conf

# ===========================================
# CONTENT SECURITY POLICY (CSP)
# ===========================================
add_header Content-Security-Policy "default-src 'self'; \
script-src 'self' 'unsafe-inline' 'unsafe-eval' https://kit.fontawesome.com https://fonts.googleapis.com https://fonts.gstatic.com; \
style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; \
font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; \
img-src 'self' data: https: http:; \
connect-src 'self'; \
frame-src 'none'; \
object-src 'none'; \
base-uri 'self'; \
form-action 'self'; \
upgrade-insecure-requests; \
block-all-mixed-content; \
referrer 'strict-origin-when-cross-origin'; \
require-trusted-types-for 'script'" always;

# ===========================================
# X-FRAME-OPTIONS
# ===========================================
add_header X-Frame-Options "DENY" always;

# ===========================================
# X-CONTENT-TYPE-OPTIONS
# ===========================================
add_header X-Content-Type-Options "nosniff" always;

# ===========================================
# X-XSS-PROTECTION
# ===========================================
add_header X-XSS-Protection "1; mode=block" always;

# ===========================================
# REFERRER-POLICY
# ===========================================
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# ===========================================
# PERMISSIONS-POLICY
# ===========================================
add_header Permissions-Policy "geolocation=(), \
camera=(), \
microphone=(), \
fullscreen=(self), \
payment=(), \
accelerometer=(), \
autoplay=(), \
clipboard-read=(), \
clipboard-write=(self), \
display-capture=(), \
encrypted-media=(), \
picture-in-picture=(self), \
screen-wake-lock=()" always;

# ===========================================
# STRICT-TRANSPORT-SECURITY (HSTS)
# ===========================================
# Uncomment when SSL is properly configured
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# ===========================================
# SERVER TOKEN REMOVAL
# ===========================================
# Hide nginx version
server_tokens off;

# ===========================================
# ADDITIONAL SECURITY MEASURES
# ===========================================
# Hide server information
more_set_headers "Server:";
more_clear_headers "X-Powered-By";

# ===========================================
# SECURITY HEADERS FOR STATIC FILES
# ===========================================
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    add_header X-Content-Type-Options "nosniff";
    add_header Referrer-Policy "strict-origin-when-cross-origin";
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# ===========================================
# BLOCK SENSITIVE FILES
# ===========================================
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

location ~* \.(htaccess|htpasswd|ini|log|sh|sql|bak|backup|conf|config)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# ===========================================
# BLOCK DIRECTORY ACCESS
# ===========================================
location ~* \.(git|node_modules|vendor) {
    deny all;
    access_log off;
    log_not_found off;
}

# ===========================================
# HTTPS REDIRECT (Optional)
# ===========================================
# Uncomment when SSL is configured
# if ($scheme != "https") {
#     return 301 https://$host$request_uri;
# }