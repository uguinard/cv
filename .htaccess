# ===========================================
# SECURITY HEADERS - APACHE CONFIGURATION
# ===========================================
# Place this file in your website root directory

# Enable SSL/TLS (uncomment when using HTTPS)
# Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
# Header always set Content-Security-Policy "upgrade-insecure-requests"

# ===========================================
# CONTENT SECURITY POLICY (CSP)
# ===========================================
# Comprehensive CSP to prevent XSS and injection attacks
Header always set Content-Security-Policy "default-src 'self'; \
script-src 'self' 'unsafe-inline' 'unsafe-eval' https://kit.fontawesome.com https://fonts.googleapis.com https://fonts.gstatic.com; \
style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; \
font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; \
img-src 'self' data: https: http:; \
connect-src 'self'; \
frame-src 'none'; \
object-src 'none'; \
base-uri 'self'; \
form-action 'self'; \
upgrade-insecure-requests; \
block-all-mixed-content; \
referrer 'strict-origin-when-cross-origin'; \
require-trusted-types-for 'script'"

# ===========================================
# X-FRAME-OPTIONS
# ===========================================
# Prevent clickjacking attacks
Header always set X-Frame-Options "DENY"

# ===========================================
# X-CONTENT-TYPE-OPTIONS
# ===========================================
# Prevent MIME type sniffing attacks
Header always set X-Content-Type-Options "nosniff"

# ===========================================
# X-XSS-PROTECTION
# ===========================================
# Enable browser XSS filtering
Header always set X-XSS-Protection "1; mode=block"

# ===========================================
# REFERRER-POLICY
# ===========================================
# Control referrer information sent with requests
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# ===========================================
# PERMISSIONS-POLICY
# ===========================================
# Control browser features and APIs
Header always set Permissions-Policy "geolocation=(), \
camera=(), \
microphone=(), \
fullscreen=(self), \
payment=(), \
accelerometer=(), \
autoplay=(), \
clipboard-read=(), \
clipboard-write=(self), \
display-capture=(), \
encrypted-media=(), \
picture-in-picture=(self), \
screen-wake-lock=()"

# ===========================================
# FEATURE-POLICY (Legacy - Deprecated)
# ===========================================
# Legacy browser support for feature policy
Header always set Feature-Policy "geolocation 'none', \
camera 'none', \
microphone 'none', \
fullscreen 'self', \
payment 'none', \
accelerometer 'none', \
autoplay 'none', \
clipboard-read 'none', \
clipboard-write 'self', \
display-capture 'none', \
encrypted-media 'none', \
picture-in-picture 'self', \
screen-wake-lock 'none'"

# ===========================================
# CORS HEADERS (If needed for external APIs)
# ===========================================
# Uncomment if you need to allow specific external domains
# Header always set Access-Control-Allow-Origin "https://yourdomain.com"
# Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
# Header always set Access-Control-Allow-Headers "Content-Type, Authorization"

# ===========================================
# SECURITY HEADERS FOR STATIC RESOURCES
# ===========================================
# Apply security headers to all static resources
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</FilesMatch>

# ===========================================
# REMOVE SERVER INFORMATION
# ===========================================
# Hide server signature to prevent information disclosure
ServerSignature Off
Header unset Server
Header unset X-Powered-By

# ===========================================
# HIDE DIRECTORY LISTINGS
# ===========================================
Options -Indexes

# ===========================================
# PROTECT SENSITIVE FILES
# ===========================================
# Protect configuration and sensitive files
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql|bak|backup|conf|config)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===========================================
# PREVENT ACCESS TO SENSITIVE DIRECTORIES
# ===========================================
# Block access to common sensitive directories
RedirectMatch 403 ^/(\.git|node_modules|vendor)/.*$

# ===========================================
# HTTPS REDIRECT (Optional)
# ===========================================
# Redirect HTTP to HTTPS (uncomment when SSL is configured)
# RewriteEngine On
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ===========================================
# ERROR PAGES SECURITY
# ===========================================
# Hide version information in error pages
ErrorDocument 400 "Bad Request"
ErrorDocument 401 "Unauthorized"
ErrorDocument 403 "Forbidden"
ErrorDocument 404 "Not Found"
ErrorDocument 500 "Internal Server Error"

# ===========================================
# CONTENT SECURITY POLICY REPORTING
# ===========================================
# Uncomment for CSP violation reporting (requires endpoint)
# Header always set Content-Security-Policy-Report-Only "default-src 'self'; report-uri /csp-report"

# ===========================================
# HSTS PRELOAD (Uncomment for HSTS preload)
# ===========================================
# Only enable this when your domain is ready for HSTS preload
# Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"